---
title: "Example with linguistic data"
output:
  html_document:
    code_folding: hide
---

Data is based on [this paper](https://arxiv.org/pdf/1308.5499.pdf). Also see [tutorial here](https://web.stanford.edu/class/psych252/section/Mixed_models_tutorial.html).

```{r setup, include = FALSE}
library(lme4)
library(tidyverse)
library(ggbeeswarm)
library(colorspace)
library(dplyr)
library(nullabor)
library(MASS)
library(mvtnorm)
library(patchwork)
library(nlme)


knitr::opts_chunk$set(message = FALSE,warning = FALSE#,
  #cache.path = "cache/",
  #cache = TRUE
  )
dataf <- read_csv(here::here("data/politeness_data.csv")) %>%
  mutate(
    scenario = fct_reorder(factor(scenario), frequency, function(x) {
      mean(x, na.rm = TRUE)
    }),
    subject = fct_reorder(subject, frequency, function(x) {
      mean(x, na.rm = TRUE)
    })
  )
```

The data contains `r nrow(df)` observations on the voice pitch (or frequency) from `r length(unique(df$subject))` subjects (3 females and 3 males) under `r length(unique(df$scenario))` scenarios with 2 attitudes (informal or polite). There is one missing value for subject `M4` for scenario 6 with polite attitude.

We fixed the missing value by the mean value of the male with scenario 6 and polite attitude.

```{r}
dataf[39, ]$frequency <- round((dataf %>% filter(
  gender == "M",
  scenario == 6,
  attitude == "pol"
) %>%
  summarise(mean(frequency, na.rm = T))), 1) %>% 
  as.numeric()

dataf <- dataf[order(dataf$subject), ]

summary(dataf)

unique(dataf$subject)
unique(dataf$scenario)
unique(dataf$attitude)

```

## About Data 

The	difference	in	politeness	level	is	represented	in	 the	column	called	 “attitude”.		
In	that	column, “pol”	stands	for	polite	and	“inf”	for	informal.	Sex	is	represented	as	
“F”	 and	 “M”	 in	 the	 column	 “gender”.	 The	 dependent	 measure	 is	 “frequency”,	
which	is	 the	 voice	 pitch	measured	in	Hertz	 (Hz). To	 remind	 you,	 higher	 values	
mean	higher	pitch.

The	interesting	random	effects	for	us	are	in	the	column	“subject”	and	“scenario”,	
the	latter	being	the	name	of	the	item	column	(remember	the	different	scenarios	
like	“asking	for	a	favor”?).

Subjects : 6
Scenario : 7
Attitude : 2 - Polite and Informal

```{r eda-plots}

subject_f <- ggplot(dataf, aes(subject, frequency, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  scale_fill_discrete_qualitative() +   # females have a higher pitch 
  ggtitle("No noise")

attitude_f<- ggplot(dataf, aes(attitude, frequency, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  facet_grid(. ~ subject) +
  scale_fill_discrete_qualitative() +   
  ggtitle("No noise")

gender_f <- ggplot(dataf, aes(gender, frequency)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +  # median is lower for polite in both males and females
  facet_grid(. ~ attitude) +
  scale_fill_discrete_qualitative()+   
  ggtitle("No noise")

scenario_f <- ggplot(dataf, aes(scenario, frequency)) +
  geom_boxplot() +
  geom_beeswarm(aes(color = gender)) +
  scale_color_discrete_qualitative()+   
  ggtitle("No noise")
```

```{r fitfn}
lin_extract_fitted_mod <- function(mod, data) {
  N <- nrow(data)
  num <- data %>%
  select_if((names(data) %in% names(random.effects(mod)))) %>%
  unique() %>%
  nrow()
  
 # subjects <- unique(data$Subject)
  #nsubjects <- length(subjects)

  #y <- data$y
  #X <- getME(mod, "X") # fixed effects model matrix
  #beta <- fixef(mod) # fixed effects estimate
  #Z <- getME(mod, "Z") # random effects matrix
  #u <- c(ranef(mod)$Subject[, 1], ranef(mod)$Subject[, 2]) # extracts the modes of the random effects
  #q <- length(u)
  
  y <- getME(mod, "y")
  X <- getME(mod, "X")
  beta <- getME(mod, "beta")
  Z <- getME(mod, "Z")
  u <- getME(mod, "b")
  q <- getME(mod, "q")
  
  nrfacs <- getME(mod,"n_rfacs")
  num <- 0

    if(nrfacs>1)
    {
 a <-  data %>%
  select_if((names(data) %in% names(random.effects(mod)))) 
 
 for(i in 1:nrfacs)
 {
  num[i] <- nrow(unique(a[i]))
 }
  vc <- as.data.frame(VarCorr(mod))
  
   R <- vc$vcov[3] * diag(N) # covariance matrix of random errors
  G1 <- vc$vcov[1] * diag(num[2])
  G2 <- vc$vcov[2] * diag(num[1])# covariance matrix of random effects

  G <- Matrix::bdiag(G1, G2)
    } else   
  {
  num <- data %>%
  select_if((names(data) %in% names(random.effects(mod)))) %>%
  unique() %>%
  nrow()

  vc <- as.data.frame(VarCorr(mod))
   R <-  vc$vcov[3] * diag(N)
  G1 <- vc$vcov[1] * diag(num)
  G2 <- vc$vcov[2] * diag(num)
  G <- Matrix::bdiag(G1, G2)
}
  

  Sigma <- Z %*% G %*% t(Z) + R # covariance matrix of marginal distribution of observations

  Sigma_inv <- solve(Sigma) # inverse of sigma

  # variance of marginal residual = sigma-X(X^t * sigma^-1 * X)*X^t
  # variance of conditional residual = R*((sigma^-1)-(sigma^-1)*X*(X^t*sigma^-1*X)^-1*X^t*sigma^-1)*R



  P <- Sigma_inv - Sigma_inv %*% X %*% vcov(mod) %*% t(X) %*% Sigma_inv # (sigma^-1)-(sigma^-1)*X*(X^t*sigma^-1*X)^-1*X^t*sigma^-1

  varMargRes <- Sigma - X %*% vcov(mod) %*% t(X) # variance of marginal residual
  varCondRes <- R %*% P %*% R # variance of conditional residual
  varU <- G - G %*% t(Z) %*% P %*% Z %*% G # random effects variance

  # fitted or estimated marginal mean = X*Beta

  fitted_df <- data %>%
    dplyr::mutate(
      fitted = as.vector(X %*% beta),
      resm = y - fitted,
      resc = as.vector(y - fitted - Z %*% u),
      index = 1:n()
    ) %>%
    mutate(
      resm_std = resm / sqrt(diag(varMargRes)[index]), # standardized marginal residual
      resc_std = resc / sqrt(diag(varCondRes)[index]) # standardized conditional residual
    ) %>%
    ungroup()

  return(fitted_df)
}
```

```{r unitfn}
lin_extract_unit_mod <- function(mod, data){
  N <- nrow(data)
  subjects <- unique(data$subject)
  nsubject <- length(subjects)
  scenarios <- unique(data$scenario)
  nscenario <- length(scenarios)

  y <- data$y
  X <- model.matrix(~attitude + gender, data = data)
  beta <- fixef(mod)
  Z1 <- model.matrix(~scenario - 1, data = data)
  Z2 <- model.matrix(~subject - 1, data = data)
  Z <- cbind(Z1, Z2)  
  u <- c(ranef(mod)$scenario[,1], ranef(mod)$subject[,1])
  q <- length(u)

  vc <- as.data.frame(VarCorr(mod))
  R <- vc$vcov[vc$grp == 'Residual'] * diag(N)
  G1 <- vc$vcov[vc$grp=="scenario"] * diag(nscenario)
  G2 <- vc$vcov[vc$grp=="subject"] * diag(nsubject)
  G <- Matrix::bdiag(G1, G2)

  Sigma <- Z %*% G %*% t(Z) + R 

  Sigma_inv <- solve(Sigma)

  P <- Sigma_inv - Sigma_inv %*% X %*% solve(t(X) %*% Sigma_inv %*% X) %*% t(X) %*% Sigma_inv

  varMargRes <- Sigma - X %*% solve(t(X) %*% Sigma_inv %*% X) %*% t(X) 
  varCondRes <- R %*% P %*% R  
  varU <- G - G %*% t(Z) %*% P %*% Z %*% G
  fitted <-  as.vector(X %*% beta)
  resm <-  y - fitted
  resc <-  y - fitted - as.vector(Z %*% u)
  
  unit_df <- expand_grid(subjects, scenarios) %>% 
    dplyr::mutate(Vi = map2_dbl(subjects, scenarios, ~{
                        ind <- data %>% 
                          dplyr::mutate(index = 1:n()) %>% 
                          filter(subject==.x,
                                 scenario==.y) %>% 
                          pull(index)
                         mi <- length(ind)
                        # standardised marginal residual
                        Ei <- solve(expm::sqrtm(varMargRes[ind, ind])) %*% resm[ind]
                        v1 <- (diag(mi)- Ei %*% t(Ei))
                        sqrt(sum(diag(v1 %*% t(v1)))) / mi
                      }),
         Mi = as.vector(t(u) %*% solve(varU) %*% u),
         index = 1:n()
         )
  
  return(unit_df)
}
```

```{r}
lin_extract_lcr_mod <- function(mod, data){
   #n <- getME(mod, "n")
  N <- nrow(data)
  num <- data %>%
  select_if((names(data) %in% names(random.effects(mod)))) %>%
  unique() %>%
  nrow()

 # y <- data$y
  #X <- getME(mod, "X")
  #beta <- fixef(mod)
  #Z <- getME(mod, "Z")
  #u <- c(ranef(mod)$Subject[, 1], ranef(mod)$Subject[, 2])
  #q <- length(u)
  
  
  y <- getME(mod, "y")
  X <- getME(mod, "X")
  beta <- getME(mod, "beta")
  Z <- getME(mod, "Z")
  u <- getME(mod, "b")
  q <- getME(mod, "q")
  
  nrfacs <- getME(mod,"n_rfacs")
  num <- 0

  if(nrfacs>1)
    {
 a <-  data %>%
  select_if((names(data) %in% names(random.effects(mod)))) 
 
 for(i in 1:nrfacs)
 {
  num[i] <- nrow(unique(a[i]))
 }
  vc <- as.data.frame(VarCorr(mod))
  
   R <- vc$vcov[3] * diag(N) # covariance matrix of random errors
  G1 <- vc$vcov[1] * diag(num[2])
  G2 <- vc$vcov[2] * diag(num[1])

  G <- Matrix::bdiag(G1, G2)
    } else   
  {
  num <- data %>%
  select_if((names(data) %in% names(random.effects(mod)))) %>%
  unique() %>%
  nrow()

  vc <- as.data.frame(VarCorr(mod))
   R <-  vc$vcov[3] * diag(N)
  G1 <- vc$vcov[1] * diag(num)
  G2 <- vc$vcov[2] * diag(num)
  G <- Matrix::bdiag(G1, G2)
}
  Sigma <- Z %*% G %*% t(Z) + R

  Sigma_inv <- solve(Sigma)

  P <- Sigma_inv - Sigma_inv %*% X %*% vcov(mod) %*% t(X) %*% Sigma_inv

  varMargRes <- Sigma - X %*% vcov(mod) %*% t(X)
  varCondRes <- R %*% P %*% R
  varU <- G - G %*% t(Z) %*% P %*% Z %*% G

  fitted <- as.vector(X %*% beta)
  resm <- y - fitted
  resc <- as.vector(y - fitted - Z %*% u)
  index <- 1:nrow(data)
  resm_std <- resm / sqrt(diag(varMargRes)[index])
  resc_std <- resc / sqrt(diag(varCondRes)[index])


  # standardized least confounded residual = c^T * e / sqrt(CRQRC^t)

  R_half <- expm::sqrtm(R)

  # singer et al calculation for least confounded residual
  auxqn <- eigen((R_half %*% P %*% R_half),
    symmetric = T,
    only.values = FALSE
  )

  p <- length(beta)

  lt <- sqrt(solve(diag((auxqn$values[1:(N - p)])))) %*% t(auxqn$vectors[1:N, 1:(N - p)]) %*% solve(expm::sqrtm(R[1:N, 1:N]))

  var_resmcp <- lt %*% varCondRes[1:N, 1:N] %*% t(lt)

  resmcp <- (lt %*% resc[1:N]) / sqrt(diag(var_resmcp))

  resmcp_sl <- tibble::tibble(resmcp)

  return(resmcp_sl)
}
```

```{r simulatefn}
lin_sim <- function(mod, data, nsim = 19, seed, std = FALSE){
  fit_sim <- simulate(mod, nsim = nsim, seed = seed)
  fit_refit <- lapply(fit_sim, refit, object = mod)
  fit_simy <- lapply(fit_refit, function(x) getME(x, 'y'))
  fit_simy_y <- do.call("cbind", fit_simy)
  fit_simy_y <- reshape2::melt(fit_simy_y)[-1]
  names(fit_simy_y) <- c(".n", "y")
  fit_simy_y$.n <- as.numeric(str_extract(fit_simy_y$.n, "\\d+"))
  fit_simy_y$attitude <- rep(data$attitude, 19)
  fit_simy_y$gender <- rep(data$gender, 19)
  fit_simy_y$subject <- rep(data$subject, 19)
  fit_simy_y$scenario <- rep(data$scenario, 19)
  return(fit_simy_y)
}
```



```{r}
std_res <- function(data) {
  purrr::map_dfr(1:19, function(i) {
  df <- data %>% filter(.n == i)
  m <- lmer(y ~ 1 +attitude + gender + 
              (1|subject) + (1|scenario),
            data = df)
  
  N <- nrow(df)
  y <- getME(m, "y")
  X <- getME(m, "X")
  beta <- getME(m, "beta")
  Z <- getME(m, "Z")
  u <- getME(m, "b")
  q <- getME(m, "q")

 nrfacs <- getME(m,"n_rfacs")
  num <- 0

    if(nrfacs>1)
    {
 a <-  data %>%
  select_if((names(data) %in% names(random.effects(m)))) 
 
 for(i in 1:nrfacs)
 {
  num[i] <- nrow(unique(a[i]))
 }
  vc <- as.data.frame(VarCorr(m))
  
   R <- vc$vcov[3] * diag(N) # covariance matrix of random errors
  G1 <- vc$vcov[1] * diag(num[2])
  G2 <- vc$vcov[2] * diag(num[1])

  G <- Matrix::bdiag(G1, G2)
    } else   
  {
  num <- data %>%
  select_if((names(data) %in% names(random.effects(m)))) %>%
  unique() %>%
  nrow()

  vc <- as.data.frame(VarCorr(m))
   R <-  vc$vcov[3] * diag(N)
  G1 <- vc$vcov[1] * diag(num)
  G2 <- vc$vcov[2] * diag(num)
  G <- Matrix::bdiag(G1, G2)
}


  Sigma <- Z %*% G %*% t(Z) + R 

  Sigma_inv <- solve(Sigma)


  P <- Sigma_inv - Sigma_inv %*% X %*% vcov(m) %*% t(X) %*% Sigma_inv

  varMargRes <- Sigma - X %*% vcov(m) %*% t(X) 
  varCondRes <- R %*% P %*% R  
  varU <- G - G %*% t(Z) %*% P %*% Z %*% G
  
  fitted = as.vector(X %*% beta)
  resm = y - fitted
  resc = y - fitted - as.vector(Z %*% u)
  index = 1:nrow(df)
  resm_std = resm / sqrt(diag(varMargRes)[index])
  resc_std = resc / sqrt(diag(varCondRes)[index])
  
  tibble::tibble(df, fitted, resm_std, resc_std, index)
})
}
```


```{r null-lcrres}
# function returns least conditional residual after 19 simulations
lcr_res <- function(data) {
 purrr::map_dfr(1:19, function(i) {
  df <- data %>% filter(.n == i)
  m <- lmer(y ~ 1 +attitude + gender + 
              (1|subject) + (1|scenario),
            data = df)

  N <- nrow(df)


  y <- getME(m, "y")
  X <- getME(m, "X")
  beta <- getME(m, "beta")
  Z <- getME(m, "Z")
  u <- getME(m, "b")
  q <- getME(m, "q")

 nrfacs <- getME(m,"n_rfacs")
 num <- 0 

  if(nrfacs>1)
    {
 a <-  data %>%
  select_if((names(data) %in% names(random.effects(m)))) 
 
 for(p in 1:nrfacs)
 {
  num[p] <- nrow(unique(a[p]))
 }
  vc <- as.data.frame(VarCorr(m))
  
   R <- vc$vcov[3] * diag(N) # covariance matrix of random errors
  G1 <- vc$vcov[1] * diag(num[2])
  G2 <- vc$vcov[2] * diag(num[1])

  G <- Matrix::bdiag(G1, G2)
    } else   
  {
  num <- data %>%
  select_if((names(data) %in% names(random.effects(m)))) %>%
  unique() %>%
  nrow()

  vc <- as.data.frame(VarCorr(m))
   R <-  vc$vcov[3] * diag(N)
  G1 <- vc$vcov[1] * diag(num)
  G2 <- vc$vcov[2] * diag(num)
  G <- Matrix::bdiag(G1, G2)
}

  Sigma <- Z %*% G %*% t(Z) + R
  Sigma_inv <- solve(Sigma)

  P <- Sigma_inv - Sigma_inv %*% X %*% vcov(m) %*% t(X) %*% Sigma_inv

  varMargRes <- Sigma - X %*% vcov(m) %*% t(X)
  varCondRes <- R %*% P %*% R
  varU <- G - G %*% t(Z) %*% P %*% Z %*% G

  fitted <- as.vector(X %*% beta)
  resm <- y - fitted
  resc <- y - fitted - as.vector(Z %*% u)
  index <- 1:nrow(df)
  resm_std <- resm / sqrt(diag(varMargRes)[index])
  resc_std <- resc / sqrt(diag(varCondRes)[index])

  R_half <- expm::sqrtm(R)

  auxqn <- eigen((R_half %*% P %*% R_half),
    symmetric = T,
    only.values = FALSE
  )

  p <- length(beta)

  lt <- sqrt(solve(diag((auxqn$values[1:(N - p)])))) %*% t(auxqn$vectors[1:N, 1:(N - p)]) %*% solve(expm::sqrtm(R[1:N, 1:N]))

  var_resmcp <- lt %*% varCondRes[1:N, 1:N] %*% t(lt)

  resmcp <- (lt %*% resc[1:N]) / sqrt(diag(var_resmcp))
  .n = i

  tibble::tibble(.n, resmcp)
})
  
}
```

```{r model}
colnames(dataf)[5] <- c("y")
#df <- na.omit(df)
fit <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = dataf)

lin_fitted <- lin_extract_fitted_mod(fit, dataf)
lin_unit <- lin_extract_unit_mod(fit, dataf)
lin_lcr <- lin_extract_lcr_mod(fit, dataf)
```


# noise 

```{r}

noise <- function(level,random){
df <- dataf
set.seed(194253)
colnames(df)[5] <- c("y")
samp5 <- sample(21, random)
f_pol <-
  round(as.numeric(
    df %>% filter(gender == "F", 
                  attitude == "pol") %>% 
      summarise(mean(y))
  ), 1)
repc_f_pol <- df %>%
  filter(gender == "F", 
         attitude == "pol")

repc_f_pol[c(samp5), ]$y <- repc_f_pol[c(samp5), ]$y + f_pol * level

set.seed(107623)
samp6 <- sample(21, random)
m_pol <-
  round(as.numeric(
    df %>% 
      filter(gender == "M", 
             attitude == "pol") %>% 
      summarise(mean(y))
  ), 1)
repc_m_pol <- df %>% 
  filter(gender == "M", 
        attitude == "pol")

repc_m_pol[c(samp6),]$y <- repc_m_pol[c(samp6),]$y + m_pol * level

set.seed(274302)
samp7 <- sample(21, random)

m_inf <-
  round(as.numeric(
    df %>% 
      filter(gender == "M", 
      attitude == "inf") %>% 
      summarise(mean(y))
  ), 1)

repc_m_inf <- df %>% 
  filter(gender == "M", 
         attitude == "inf")

repc_m_inf[c(samp7), ]$y <- repc_m_inf[c(samp7), ]$y + m_inf * level

set.seed(981234)
samp8 <- sample(21, random)
f_inf <-
  round(as.numeric(
    df %>% 
      filter(gender == "F", 
             attitude == "inf") %>% 
      summarise(mean(y))
  ), 1)
repc_f_inf <- df %>% 
  filter(gender == "F", 
         attitude == "inf")
repc_f_inf[c(samp8), ]$y <- repc_f_inf[c(samp8), ]$y + f_inf * level

repc3 <- rbind(repc_f_inf, 
               repc_f_pol, 
               repc_m_inf, 
               repc_m_pol)

data <- repc3[order(repc3$subject),]
return(data)
}
```

both females and males for each of the attitude were taken and a noise of 20% of total mean value was injected into a frequency level under a random scenario.


```{r}

set01 <- noise(0.05,1)
set02 <- noise(0.1,1)
set03 <- noise(0.15,1)

```


```{r}

set1 <- noise(0.2,1)

subject_set1 <- 
  ggplot(set1, aes(subject, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  scale_fill_discrete_qualitative()  +
  ggtitle("20%")  # females have a higher pitch 

attitude_set1 <- ggplot(set1, aes(attitude, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  facet_grid(. ~ subject) +
  scale_fill_discrete_qualitative()+
  ggtitle("20%")

gender_set1 <- ggplot(set1, aes(gender, y)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +  # median is lower for polite in both males and females
  facet_grid(. ~ attitude) +
  scale_fill_discrete_qualitative()+
  ggtitle("20%")

scenario_set1 <- ggplot(set1, aes(scenario, y)) +
  geom_boxplot() +
  geom_beeswarm(aes(color = gender)) +
  scale_color_discrete_qualitative()+
  ggtitle("20%")


```


```{r}
set2 <- noise(0.25,1)

subject_set2 <- 
  ggplot(set2, aes(subject, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  scale_fill_discrete_qualitative()+
  ggtitle("25%")# females have a higher pitch 

attitude_set2 <- ggplot(set2, aes(attitude, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  facet_grid(. ~ subject) +
  scale_fill_discrete_qualitative()+
  ggtitle("25%")

gender_set2 <- ggplot(set2, aes(gender, y)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +  # median is lower for polite in both males and females
  facet_grid(. ~ attitude) +
  scale_fill_discrete_qualitative()+
  ggtitle("25%")

scenario_set2 <- ggplot(set2, aes(scenario, y)) +
  geom_boxplot() +
  geom_beeswarm(aes(color = gender)) +
  scale_color_discrete_qualitative()+
  ggtitle("25%")


summary(dataf)
summary(set1)  # the average frequency increases. Median remains unchanged
summary(set2)
``` 


```{r}
set3 <- noise(0.3,1)

subject_set3 <- 
  ggplot(set3, aes(subject, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  scale_fill_discrete_qualitative() +
  ggtitle("30%")   # females have a higher pitch 

attitude_set3 <- ggplot(set3, aes(attitude, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  facet_grid(. ~ subject) +
  scale_fill_discrete_qualitative()+
  ggtitle("30%")

gender_set3 <- ggplot(set3, aes(gender, y)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +  # median is lower for polite in both males and females
  facet_grid(. ~ attitude) +
  scale_fill_discrete_qualitative()+
  ggtitle("30%")

scenario_set3 <- ggplot(set3, aes(scenario, y)) +
  geom_boxplot() +
  geom_beeswarm(aes(color = gender)) +
  scale_color_discrete_qualitative()+
  ggtitle("30%")



summary(dataf)
summary(set1)  # the average frequency increases. Median remains unchanged
summary(set2)
summary(set3)
```

```{r}
set4 <- noise(0.4,1)

subject_set4 <- 
  ggplot(set4, aes(subject, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  scale_fill_discrete_qualitative()  +
  ggtitle("40%")
  # females have a higher pitch 

attitude_set4 <- ggplot(set4, aes(attitude, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  facet_grid(. ~ subject) +
  scale_fill_discrete_qualitative() +
  ggtitle("40%")

gender_set4 <- ggplot(set4, aes(gender, y)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +  # median is lower for polite in both males and females
  facet_grid(. ~ attitude) +
  scale_fill_discrete_qualitative()+
  ggtitle("40%")

scenario_set4 <- ggplot(set4, aes(scenario, y)) +
  geom_boxplot() +
  geom_beeswarm(aes(color = gender)) +
  scale_color_discrete_qualitative()+
  ggtitle("40%")


```

## data plots

```{r}
stdm0 <- ggplot(lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc0 <- ggplot(lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq0 <- ggplot(lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr0 <- ggplot(lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")
```

## set 01

```{r}
set01_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set01)
```

```{r}
set01_lin_fitted <- lin_extract_fitted_mod(set01_lin_mod, set01)
set01_lin_lcr <- lin_extract_lcr_mod(set01_lin_mod, set01)
```

```{r}
stdm01 <- ggplot(set01_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc01 <- ggplot(set01_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq01 <- ggplot(set01_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr01 <- ggplot(set01_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")



```

## set 02

```{r}
set02_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set02)
```

```{r}
set02_lin_fitted <- lin_extract_fitted_mod(set02_lin_mod, set02)
set02_lin_lcr <- lin_extract_lcr_mod(set02_lin_mod, set02)
```

```{r}
stdm02 <- ggplot(set02_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc02 <- ggplot(set02_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq02 <- ggplot(set02_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr02 <- ggplot(set02_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")



```

## set 03

```{r}
set03_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set03)
```

```{r}
set03_lin_fitted <- lin_extract_fitted_mod(set03_lin_mod, set03)
set03_lin_lcr <- lin_extract_lcr_mod(set03_lin_mod, set03)
```

```{r}
stdm03 <- ggplot(set03_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc03 <- ggplot(set03_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq03 <- ggplot(set03_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr03 <- ggplot(set03_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")



```


## set 1

```{r}
set1_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set1)
```

```{r}
set1_lin_fitted <- lin_extract_fitted_mod(set1_lin_mod, set1)
set1_lin_lcr <- lin_extract_lcr_mod(set1_lin_mod, set1)
```

```{r}
stdm1 <- ggplot(set1_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc1 <- ggplot(set1_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq1 <- ggplot(set1_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr1 <- ggplot(set1_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")



```


## set 2

```{r}
set2_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set2)
```

```{r}
set2_lin_fitted <- lin_extract_fitted_mod(set2_lin_mod, set2)
set2_lin_lcr <- lin_extract_lcr_mod(set2_lin_mod, set2)
```

```{r}
stdm2 <- ggplot(set2_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc2 <- ggplot(set2_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq2 <- ggplot(set2_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr2 <- ggplot(set2_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

```


## set 3

```{r}
set3_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set3)
```

```{r}
set3_lin_fitted <- lin_extract_fitted_mod(set3_lin_mod, set3)
set3_lin_lcr <- lin_extract_lcr_mod(set3_lin_mod, set3)
```

```{r}
stdm3 <- ggplot(set3_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc3 <- ggplot(set3_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq3 <- ggplot(set3_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr3 <- ggplot(set3_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")



```


## set 4

```{r}
set4_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set4)
```

```{r}
set4_lin_fitted <- lin_extract_fitted_mod(set4_lin_mod, set4)
set4_lin_lcr <- lin_extract_lcr_mod(set4_lin_mod, set4)
```

```{r}
stdm4 <- ggplot(set4_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc4 <- ggplot(set4_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq4 <- ggplot(set4_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr4 <- ggplot(set4_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")



```




## number of scenarios changed

```{r}
set5 <- noise(0.2,2)

subject_set5 <- 
  ggplot(set5, aes(subject, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  scale_fill_discrete_qualitative()  +
  ggtitle("2 scenarios")


attitude_set5 <- ggplot(set5, aes(attitude, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  facet_grid(. ~ subject) +
  scale_fill_discrete_qualitative() +
  ggtitle("2 scenarios")

gender_set5 <- ggplot(set5, aes(gender, y)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +  
  facet_grid(. ~ attitude) +
  scale_fill_discrete_qualitative()+
  ggtitle("2 scenarios")

scenario_set5 <- ggplot(set5, aes(scenario, y)) +
  geom_boxplot() +
  geom_beeswarm(aes(color = gender)) +
  scale_color_discrete_qualitative()+
  ggtitle("2 scenarios")

```


```{r}
set6 <- noise(0.2,4)

subject_set6 <- 
  ggplot(set6, aes(subject, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  scale_fill_discrete_qualitative()  +
  ggtitle("4 scenarios")


attitude_set6 <- ggplot(set6, aes(attitude, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  facet_grid(. ~ subject) +
  scale_fill_discrete_qualitative() +
  ggtitle("4 scenarios")

gender_set6 <- ggplot(set6, aes(gender, y)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +  
  facet_grid(. ~ attitude) +
  scale_fill_discrete_qualitative()+
  ggtitle("4 scenarios")

scenario_set6 <- ggplot(set6, aes(scenario, y)) +
  geom_boxplot() +
  geom_beeswarm(aes(color = gender)) +
  scale_color_discrete_qualitative()+
  ggtitle("4 scenarios")


```

```{r}
set7 <- noise(0.2,6)

subject_set7 <- 
  ggplot(set7, aes(subject, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  scale_fill_discrete_qualitative()  +
  ggtitle("6 scenarios")


attitude_set7 <- ggplot(set7, aes(attitude, y, fill = gender)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +
  facet_grid(. ~ subject) +
  scale_fill_discrete_qualitative() +
  ggtitle("6 scenarios")

gender_set7 <- ggplot(set7, aes(gender, y)) +
  geom_boxplot(width = 0.5) +
  geom_beeswarm(color = "#383838") +  
  facet_grid(. ~ attitude) +
  scale_fill_discrete_qualitative()+
  ggtitle("6 scenarios")

scenario_set7 <- ggplot(set7, aes(scenario, y)) +
  geom_boxplot() +
  geom_beeswarm(aes(color = gender)) +
  scale_color_discrete_qualitative()+
  ggtitle("6 scenarios")


```



## set 5

```{r}
set5_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set5)
```

```{r}
set5_lin_fitted <- lin_extract_fitted_mod(set5_lin_mod, set5)
set5_lin_lcr <- lin_extract_lcr_mod(set5_lin_mod, set5)
```

```{r}
stdm5 <- ggplot(set1_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc5 <- ggplot(set1_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq5 <- ggplot(set1_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr5 <- ggplot(set1_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")



```


## set 6

```{r}
set6_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set6)
```

```{r}
set6_lin_fitted <- lin_extract_fitted_mod(set6_lin_mod, set6)
set6_lin_lcr <- lin_extract_lcr_mod(set6_lin_mod, set6)
```

```{r}
stdm6 <- ggplot(set6_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc6 <- ggplot(set6_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq6 <- ggplot(set6_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr6 <- ggplot(set6_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

```


## set 7

```{r}
set7_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set7)
```

```{r}
set7_lin_fitted <- lin_extract_fitted_mod(set7_lin_mod, set7)
set7_lin_lcr <- lin_extract_lcr_mod(set7_lin_mod, set7)
```

```{r}
stdm7 <- ggplot(set7_lin_fitted, aes(index, 
                          resm_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0) +
  xlab(NULL) + 
  ylab(NULL) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(), 
        axis.ticks.y = element_blank(), 
        legend.position="none")

stdc7 <- ggplot(set7_lin_fitted, aes(index, 
                          resc_std)) + 
  geom_point() + 
  geom_hline(yintercept = 0)

stcq7 <- ggplot(set7_lin_fitted, 
       aes(sample = resc_std)) + 
  geom_qq() + 
  geom_qq_line(color = "red")

stdlcr7 <- ggplot(set7_lin_lcr, 
       aes(sample = resmcp)) + 
  geom_qq() + 
  geom_qq_line(color = "red")



```

## mean value 

```{r}
stdm0+ggtitle("no noise")+stdm1+ggtitle("20% mean") +stdm2+ggtitle("25%")+stdm3+ggtitle("30%")+stdm4+ggtitle("35%")
stdc0+ggtitle("no noise")+stdc1+ggtitle("20% mean") +stdc2+ggtitle("25%")+stdc3+ggtitle("30%")+stdc4+ggtitle("35%")
stcq0+ggtitle("no noise")+stcq1+ggtitle("20% mean") +stcq2+ggtitle("25%")+stcq3+ggtitle("30%")+stcq4+ggtitle("35%")
stdlcr0+ggtitle("no noise")+stdlcr1+ggtitle("20% mean") +stdlcr2+ggtitle("25%")+stdlcr3+ggtitle("30%")+stdlcr4+ggtitle("35%")
```

```{r}
subject_f+subject_set1+subject_set2+subject_set3+subject_set4
attitude_f+attitude_set1+attitude_set2+attitude_set3+attitude_set4
gender_f+gender_set1+gender_set2+gender_set3+gender_set4
scenario_f+scenario_set1+scenario_set2+scenario_set3+scenario_set4

summary(dataf)
summary(set1)  # the average frequency increases. Median remains unchanged
summary(set2)
summary(set3)
summary(set4)
```


#number of scenarios changed

```{r}
stdm0+ggtitle("no noise")+stdm5+ggtitle("2 scenarios") +stdm6+ggtitle("4 scenarios")+stdm7+ggtitle("6 scenarios")
stdc0+ggtitle("no noise")+stdc5+ggtitle("2 sc.") +stdc6+ggtitle("4.sce")+stdc7+ggtitle("6 sc.")
stcq0+ggtitle("no noise")+stcq5+ggtitle("2sc") +stcq6+ggtitle("4 sc")+stcq7+ggtitle("6sc")
stdlcr0+ggtitle("no noise")+stdlcr5+ggtitle("2sc") +stdlcr6+ggtitle("4 sc")+stdlcr7+ggtitle("6 sc")
```

```{r}


subject_f+subject_set5+subject_set6+subject_set7
attitude_f+attitude_set5+attitude_set6+attitude_set7
gender_f+gender_set5+gender_set6+gender_set7
scenario_f+scenario_set5+scenario_set6+scenario_set7

summary(dataf)
summary(set5)  
summary(set6)
summary(set7)

```

```{r v1mod}
set4_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set4)
```

```{r v1-extract}
set4_lin_fitted <- lin_extract_fitted_mod(set4_lin_mod, set4)
set4_lin_lcr <- lin_extract_lcr_mod(set4_lin_mod, set4)


```

```{r v11-sim}
set4_sim <- lin_sim(set4_lin_mod, set4, seed = 1234)
```

```{r fittednull-v11}
set4_lin_sim_fitted <- std_res(set4_sim)
```

```{r lcrsimnull-v11}
set4_lin_sim_lcr <- lcr_res(set4_sim)
unique(set4_lin_sim_lcr$.n)
```



```{r}
set4_1 <-  lineup(true = set4_lin_fitted,
                samples = set4_lin_sim_fitted,
                pos = 7) %>%
  ggplot(aes(index,
             resm_std)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  facet_wrap( ~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )


set4_2 <- lineup(true = set4_lin_fitted,
                samples = set4_lin_sim_fitted,
                pos = 7) %>%
  ggplot(aes(index,
             resc_std)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set4_3 <- lineup(true = set4_lin_fitted,
                samples = set4_lin_sim_fitted,
                pos = 9) %>%
  ggplot(aes(sample = resc_std)) +
  geom_qq() +
  geom_qq_line(color = "red") +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set4_4 <- lineup(true = set4_lin_lcr,
                samples = set4_lin_sim_lcr,
                pos = 9) %>%
  ggplot(aes(sample = resmcp)) +
  geom_qq() +
  geom_qq_line(color = "red") +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set4_1
set4_2
set4_3
set4_4

```

```{r}
set7_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set7)

set7_lin_fitted <- lin_extract_fitted_mod(set7_lin_mod, set7)
set7_lin_lcr <- lin_extract_lcr_mod(set7_lin_mod, set7)



set7_sim <- lin_sim(set7_lin_mod, set7, seed = 1234)

set7_lin_sim_fitted <- std_res(set7_sim)
set7_lin_sim_lcr <- lcr_res(set7_sim)
```

```{r}
set7_1 <-  lineup(true = set7_lin_fitted,
                samples = set7_lin_sim_fitted,
                pos = 7) %>%
  ggplot(aes(index,
             resm_std)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  facet_wrap( ~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )


set7_2 <- lineup(true = set7_lin_fitted,
                samples = set7_lin_sim_fitted,
                pos = 7) %>%
  ggplot(aes(index,
             resc_std)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set7_3 <- lineup(true = set7_lin_fitted,
                samples = set7_lin_sim_fitted,
                pos = 9) %>%
  ggplot(aes(sample = resc_std)) +
  geom_qq() +
  geom_qq_line(color = "red") +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set7_4 <- lineup(true = set7_lin_lcr,
                samples = set7_lin_sim_lcr,
                pos = 9) %>%
  ggplot(aes(sample = resmcp)) +
  geom_qq() +
  geom_qq_line(color = "red") +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )
```


## mean value 

```{r}
stdm0+ggtitle("no noise")+stdm01+ggtitle("5% mean") +stdm02+ggtitle("10%")+stdm03+ggtitle("15%")+
stdm1+ggtitle("20% mean") +stdm2+ggtitle("25%")+stdm3+ggtitle("30%")+stdm4+ggtitle("35%")+stdm5+ggtitle("2 scenarios")+stdm6+ggtitle("4 scenarios")+stdm7+ggtitle("6 scenarios")


stdc0+ggtitle("no noise")+stdc01+ggtitle("5% mean") +stdc02+ggtitle("10%")+stdc03+ggtitle("15%")+
stdc1+ggtitle("20% mean") +stdc2+ggtitle("25%")+stdc3+ggtitle("30%")+stdc4+ggtitle("35%")+
stdc5+ggtitle("2 sc.") +stdc6+ggtitle("4.sce")+stdc7+ggtitle("6 sc.")


stcq0+ggtitle("no noise")+stcq01+ggtitle("5% mean") +stcq02+ggtitle("10%")+stcq03+ggtitle("15%")+
stcq1+ggtitle("20% mean") +stcq2+ggtitle("25%")+stcq3+ggtitle("30%")+
stcq4+ggtitle("35%")+stcq5+ggtitle("2sc") +stcq6+ggtitle("4 sc")+stcq7+ggtitle("6sc")


stdlcr0+ggtitle("no noise")+stdlcr01+ggtitle("5% mean") +stdlcr02+ggtitle("10%")+stdlcr03+ggtitle("15%")+
stdlcr1+ggtitle("20% mean") +stdlcr2+ggtitle("25%")+stdlcr3+ggtitle("30%")+stdlcr4+ggtitle("35%")+
stdlcr5+ggtitle("2sc") +stdlcr6+ggtitle("4 sc")+stdlcr7+ggtitle("6 sc")

```

```{r}
subject_f+subject_set1+subject_set2+subject_set3+subject_set4
attitude_f+attitude_set1+attitude_set2+attitude_set3+attitude_set4
gender_f+gender_set1+gender_set2+gender_set3+gender_set4
scenario_f+scenario_set1+scenario_set2+scenario_set3+scenario_set4

summary(dataf)
summary(set1)  # the average frequency increases. Median remains unchanged
summary(set2)
summary(set3)
summary(set4)
```


#number of scenarios changed

```{r}
stdm0+ggtitle("no noise")+stdm5+ggtitle("2 scenarios") +stdm6+ggtitle("4 scenarios")+stdm7+ggtitle("6 scenarios")
stdc0+ggtitle("no noise")+stdc5+ggtitle("2 sc.") +stdc6+ggtitle("4.sce")+stdc7+ggtitle("6 sc.")
stcq0+ggtitle("no noise")+stcq5+ggtitle("2sc") +stcq6+ggtitle("4 sc")+stcq7+ggtitle("6sc")
stdlcr0+ggtitle("no noise")+stdlcr5+ggtitle("2sc") +stdlcr6+ggtitle("4 sc")+stdlcr7+ggtitle("6 sc")
```

```{r}


subject_f+subject_set5+subject_set6+subject_set7
attitude_f+attitude_set5+attitude_set6+attitude_set7
gender_f+gender_set5+gender_set6+gender_set7
scenario_f+scenario_set5+scenario_set6+scenario_set7

summary(dataf)
summary(set5)  
summary(set6)
summary(set7)

```

```{r}
## scenarios are less obvious

set4_1+ggtitle("35% mean")+set7_1+ggtitle("6 scenarios")
set4_2+ggtitle("35% mean")+set7_2+ggtitle("6 scenarios")
set4_3+ggtitle("35% mean")+set7_3+ggtitle("6 scenarios")
set4_3+ggtitle("35% mean")+set7_4+ggtitle("6 scenarios")

```

## set 01 
```{r}
set01_lin_fitted <- lin_extract_fitted_mod(set01_lin_mod, set01)
set01_lin_lcr <- lin_extract_lcr_mod(set01_lin_mod, set01)



set01_sim <- lin_sim(set01_lin_mod, set01, seed = 1234)

set01_lin_sim_fitted <- std_res(set01_sim)
set01_lin_sim_lcr <- lcr_res(set01_sim)
```

```{r}
set01_1 <-  lineup(true = set01_lin_fitted,
                samples = set01_lin_sim_fitted,
                pos = 7) %>%
  ggplot(aes(index,
             resm_std)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  facet_wrap( ~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )


set01_2 <- lineup(true = set01_lin_fitted,
                samples = set01_lin_sim_fitted,
                pos = 7) %>%
  ggplot(aes(index,
             resc_std)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set01_3 <- lineup(true = set01_lin_fitted,
                samples = set01_lin_sim_fitted,
                pos = 9) %>%
  ggplot(aes(sample = resc_std)) +
  geom_qq() +
  geom_qq_line(color = "red") +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set01_4 <- lineup(true = set01_lin_lcr,
                samples = set01_lin_sim_lcr,
                pos = 9) %>%
  ggplot(aes(sample = resmcp)) +
  geom_qq() +
  geom_qq_line(color = "red") +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )


set01_1
set01_2
set01_3
set01_4
```
```{r}
set1_lin_mod <- lmer(y ~ attitude + gender + 
              (1|subject) + (1|scenario),
            data = set1)

set1_lin_fitted <- lin_extract_fitted_mod(set1_lin_mod, set1)
set1_lin_lcr <- lin_extract_lcr_mod(set1_lin_mod, set1)

set1_sim <- lin_sim(set1_lin_mod, set1, seed = 1234)

set1_lin_sim_fitted <- std_res(set1_sim)

set1_lin_sim_lcr <- lcr_res(set1_sim)

set1_1 <-  lineup(true = set1_lin_fitted,
                samples = set1_lin_sim_fitted,
                pos = 7) %>%
  ggplot(aes(index,
             resm_std)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  facet_wrap( ~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )


set1_2 <- lineup(true = set1_lin_fitted,
                samples = set1_lin_sim_fitted,
                pos = 7) %>%
  ggplot(aes(index,
             resc_std)) +
  geom_point() +
  geom_hline(yintercept = 0) +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set1_3 <- lineup(true = set1_lin_fitted,
                samples = set1_lin_sim_fitted,
                pos = 9) %>%
  ggplot(aes(sample = resc_std)) +
  geom_qq() +
  geom_qq_line(color = "red") +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set1_4 <- lineup(true = set1_lin_lcr,
                samples = set1_lin_sim_lcr,
                pos = 9) %>%
  ggplot(aes(sample = resmcp)) +
  geom_qq() +
  geom_qq_line(color = "red") +
  facet_wrap(~ .sample, ncol = 5) +
  xlab(NULL) +
  ylab(NULL) +
  theme(
    axis.text.y = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    legend.position = "none"
  )

set1_1
set1_2
set1_3
set1_4

```

```{r}
set01_1+ggtitle("5% mean")+set1_1+ggtitle("20%")
set01_2+ggtitle("5% mean")+set1_2+ggtitle("20%")
set01_3+ggtitle("5% mean")+set1_3+ggtitle("20%")
set01_3+ggtitle("5% mean")+set1_4+ggtitle("20%")
```

